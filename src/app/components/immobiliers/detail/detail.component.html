<div class="page-container">
  <app-header></app-header>

  <div class="property-detail-container">
    <div *ngIf="property" class="property-content">
      <div class="property-gallery">
        <div class="main-image">
          <img [src]="getImageUrl(property.photoPath)" 
               [alt]="property.type + ' à ' + property.ville"
               class="property-image">
        </div>
      </div>

      <div class="property-info">
        <div class="price-section">
          <span class="price">{{property.prix | currency:'EUR':'symbol':'1.0-0'}}</span>
          <span class="price-label">Prix</span>
        </div>

        <div class="details-grid">
          <div class="detail-item">
            <i class="fas fa-ruler-combined"></i>
            <div>
              <span class="detail-label">Surface</span>
              <span class="detail-value">{{property.superficie}} m²</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="fas fa-calendar-alt"></i>
            <div>
              <span class="detail-label">Année</span>
              <span class="detail-value">{{property.anneeConstruction || 'N/A'}}</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="fas fa-layer-group"></i>
            <div>
              <span class="detail-label">Étage</span>
              <span class="detail-value">{{property.etage || 'N/A'}}</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="fas fa-home"></i>
            <div>
              <span class="detail-label">Type</span>
              <span class="detail-value">{{property.type}}</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="fas fa-map-marker-alt"></i>
            <div>
              <span class="detail-label">Localisation</span>
              <span class="detail-value">{{property.ville}}</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="fas fa-info-circle"></i>
            <div>
              <span class="detail-label">État</span>
              <span class="detail-value">{{property.etat || 'Non spécifié'}}</span>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="back-button" routerLink="/list" aria-label="Retour à la liste">
            <svg class="back-icon" viewBox="0 0 24 24">
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            <span class="back-text">Retour à la liste</span>
          </button>
          <button class="btn-buy" (click)="buyProperty()">
            <i class="fas fa-shopping-cart"></i> Acheter le bien
          </button>
          <button (click)="onLoadMapClick()">Charger la localisation</button>
        </div>
      </div>
    </div>

    <div *ngIf="isLoading" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <div *ngIf="showMap && property?.latitude && property?.longitude" class="map-container">
      <div id="leaflet-map" class="leaflet-map"></div>
    </div>

    <!-- Section des biens similaires avec le design de list.component.html -->
    <div *ngIf="recommendedProperties.length > 0" class="similar-properties-section">
      <h3>Biens similaires dans la région</h3>
      <div class="property-list">
        <div *ngFor="let item of recommendedProperties" class="property-card" 
             (mouseenter)="hoveredProperty = item.id" 
             (mouseleave)="hoveredProperty = null">
          
          <!-- Image de la propriété -->
          <div class="property-image">
            <img [src]="getImageUrl(item.photoPath)" 
                 [alt]="item.type + ' à ' + item.ville">
            <div class="property-badge">{{ item.type }}</div>
          </div>
          
          <div class="property-info">
            <h3 class="property-title">{{ item.ville }}</h3>
            <div class="property-price">{{ item.prix | currency:'EUR':'symbol':'1.0-0' }}</div>
            <div class="property-details">
              <span><i class="fas fa-ruler-combined"></i> {{ item.superficie }} m²</span>
              <span *ngIf="item.nombrePieces"><i class="fas fa-door-open"></i> {{ item.nombrePieces }} pièces</span>
            </div>
            
            <!-- Détails supplémentaires qui apparaissent au survol -->
            <div class="property-extra-details" [class.show]="hoveredProperty === item.id">
              <div class="detail-row">
                <i class="fas fa-calendar-alt"></i>
                <span>Année: {{item.anneeConstruction || 'N/A'}}</span>
              </div>
              <div class="detail-row">
                <i class="fas fa-layer-group"></i>
                <span>Étage: {{item.etage || 'N/A'}}</span>
              </div>
              <div class="detail-row">
                <i class="fas fa-info-circle"></i>
                <span>État: {{item.etat || 'Non spécifié'}}</span>
              </div>

              <!-- Bouton "Afficher plus de détails" -->
              <button class="action-button view-more-button" (click)="viewDetails(item.id)">
                <i class="fas fa-eye"></i> Afficher plus de détails
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>